{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Customer Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/customerpage.css' %}">
    <link rel="stylesheet" href="{% static 'css/headsidenav.css' %}">
    <style>
        body {
            background: url('{% static "images/customerpage.jpg" %}') no-repeat center center fixed;
            background-size: cover;
            margin: 0;
            margin-left: 250px; /* Adjusting body margin to make space for the fixed sidebar */
        }

        /* Add margin between icons and text */
        .sidenav a i, .dropdown-content a i {
            margin-right: 10px; /* Space between icon and text */
        }

    </style>
    <!-- Add Font Awesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Add SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
</head>
<body>

    <!-- Side Navigation (Always Visible) -->
    <div id="mySidenav" class="sidenav"><br><br><br><br>
        <a href="{% url 'custproductslist' %}" id="products"><i class="fas fa-shopping-basket"></i> Products List</a><br>
        <a href="{% url 'wishlist' %}"><i class="fas fa-heart"></i> Your Wishlist</a><br>
        <a href="{% url 'viewcart' %}"><i class="fas fa-shopping-cart"></i> Your Cart</a><br>
        <a href="{% url 'orderhistory' %}"><i class="fas fa-shopping-bag"></i> Your Orders</a><br>
        <a href="{% url 'preorderlisting' %}"><i class="fas fa-clipboard-list"></i> Your Pre-Orders</a><br>
        <a href="{% url 'feedbackpage' %}" id="feed"><i class="fas fa-comment"></i> Give Feedback</a><br>
        <a href="{% url 'custfeedback' %}" id="feed"><i class="fas fa-comments"></i> Your Feedbacks</a><br>
    </div>

    <!-- Navigation Bar -->
    <ul>
        <div class="brand-name"><span>Dairy Care System</span></div>
        <div class="header">
            <div class="nav-item">
                <li>
                    <b><a href="#" class="username" onclick="toggleDropdown()"><i class="fas fa-user-circle"></i> {{ username }}</a></b>
                    <div class="dropdown-content" id="dropdown-content">
                        <a href="{% url 'userprofile' %}"><i class="fas fa-user"></i> Profile</a>
                        <a href="#" onclick="confirmLogout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </li>
            </div>
        </div>
    </ul>

    <br><br><br>

    <center>
        <!-- Message and Quote -->
        <div class="message">
            <h1>Welcome, {{ username }}!</h1> <br><br>
            We value your trust and aim to deliver the best shopping experience for you.
        </div><br><br>
        <div class="quote">
            A satisfied customer is the best business strategy of all.
        </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

        <footer>
            <b><p>&copy; 2024 Dairy Care System. All rights reserved.</p></b>
        </footer>
    </center>

    <!-- Chatbot Icon -->
    <div class="chatbot-icon" onclick="toggleChatPopup()">
        <i class="fas fa-comments"></i>
    </div>

    <!-- Chatbot Popup -->
    <div class="chat-popup" id="chatPopup">
        <div class="chat-popup-header">
            Chat Assistant
        </div>
        <div class="chat-popup-body" id="chatBody">
            <!-- Chat messages will appear here -->
        </div>
        <div class="chat-popup-footer">
            <input type="text" id="chatInput" placeholder="Type a message...">
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>


    <script>
        // Toggle Chat Popup Visibility with animation
        function toggleChatPopup() {
            const chatPopup = document.getElementById('chatPopup');
            if (chatPopup.style.display === 'block') {
                chatPopup.style.animation = 'slideUp 0.3s ease-out reverse';
                setTimeout(() => {
                    chatPopup.style.display = 'none';
                }, 300);
            } else {
                chatPopup.style.display = 'block';
                chatPopup.style.animation = 'slideUp 0.3s ease-out';
                // Focus on input when chat opens
                document.getElementById('chatInput').focus();
            }
        }

        // Handle Sending Message
        function sendMessage() {
            const chatInput = document.getElementById('chatInput');
            const chatBody = document.getElementById('chatBody');
            const message = chatInput.value.trim();

            if (message) {
                // Add user message
                appendMessage('user', message);
                chatInput.value = '';

                // Send message to the server via AJAX
                fetch("{% url 'chatbot_response' %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}' // Ensure CSRF token is included
                    },
                    body: JSON.stringify({ message: message })
                })
                .then(response => response.json())
                .then(data => {
                    // Add bot response
                    if (data.response) {
                        appendMessage('bot', data.response);
                    } else {
                        appendMessage('bot', "I'm sorry, I didn't understand that.");
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    appendMessage('bot', "There was an error processing your request. Please try again.");
                });
            }
        }


        // Append message to chat
        function appendMessage(type, text) {
            const chatBody = document.getElementById('chatBody');
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'user' ? 'user-message' : 'bot-message';
            messageDiv.textContent = text;
            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        // Handle Enter key press
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>


    <!-- Add SweetAlert2 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // Toggle dropdown on click
        function toggleDropdown() {
            var dropdown = document.getElementById("dropdown-content");
            if (dropdown.style.display === "block") {
                dropdown.style.display = "none";
            } else {
                dropdown.style.display = "block";
            }
        }

        // Close the dropdown if clicked outside of it
        window.onclick = function(event) {
            if (!event.target.matches('.username')) {
                var dropdown = document.getElementById("dropdown-content");
                if (dropdown.style.display === "block") {
                    dropdown.style.display = "none";
                }
            }
        }

        // Custom SweetAlert2 logout confirmation
        function confirmLogout() {
            Swal.fire({
                title: 'Are you sure?',
                text: "You will be logged out of Dairy Care System!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, logout',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Redirect to logout URL
                    window.location.href = "{% url 'logout' %}";
                }
            });
        }
    </script>

</body>
</html>


<!-- <script>
    // Toggle Chat Popup Visibility with animation
    function toggleChatPopup() {
        const chatPopup = document.getElementById('chatPopup');
        if (chatPopup.style.display === 'block') {
            chatPopup.style.animation = 'slideUp 0.3s ease-out reverse';
            setTimeout(() => {
                chatPopup.style.display = 'none';
            }, 300);
        } else {
            chatPopup.style.display = 'block';
            chatPopup.style.animation = 'slideUp 0.3s ease-out';
            // Focus on input when chat opens
            document.getElementById('chatInput').focus();
        }
    }

    // Handle Sending Message
    function sendMessage() {
        const chatInput = document.getElementById('chatInput');
        const chatBody = document.getElementById('chatBody');
        const message = chatInput.value.trim();

        if (message) {
            // Add user message
            appendMessage('user', message);
            chatInput.value = '';

            // Simulate bot response
            setTimeout(() => {
                const responses = [
                    "How can I help you today?",
                    "I'm here to assist with your dairy product needs!",
                    "Let me know if you have any questions about our products.",
                    "I'd be happy to help you find what you're looking for."
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                appendMessage('bot', randomResponse);
            }, 1000);
        }
    }

    // Append message to chat
    function appendMessage(type, text) {
        const chatBody = document.getElementById('chatBody');
        const messageDiv = document.createElement('div');
        messageDiv.className = type === 'user' ? 'user-message' : 'bot-message';
        messageDiv.textContent = text;
        chatBody.appendChild(messageDiv);
        chatBody.scrollTop = chatBody.scrollHeight;
    }

    // Handle Enter key press
    document.getElementById('chatInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });
</script> -->